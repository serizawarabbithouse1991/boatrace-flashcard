<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>„Éú„Éº„Éà„É¨„Éº„ÇπÁî®Ë™û ÂçòË™ûÂ∏≥</title>
  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', 'Hiragino Sans', 'Meiryo', sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }

    h1 {
      color: white;
      margin-bottom: 10px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    /* Auth Header */
    .auth-header {
      width: 100%;
      max-width: 500px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      padding: 8px 12px;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
    }

    .auth-header .user-info {
      color: white;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .auth-header .sync-status {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 10px;
      background: #4CAF50;
      color: white;
    }

    .auth-header .sync-status.offline {
      background: #ff9800;
    }

    .auth-btn {
      padding: 6px 14px;
      border: none;
      border-radius: 15px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .auth-btn.login {
      background: #4CAF50;
      color: white;
    }

    .auth-btn.logout {
      background: rgba(255,255,255,0.2);
      color: white;
    }

    .auth-btn:hover {
      transform: scale(1.05);
    }

    /* Auth Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-overlay.show {
      display: flex;
    }

    .modal {
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    }

    .modal h2 {
      color: #1e3c72;
      margin-bottom: 20px;
      text-align: center;
    }

    .modal-tabs {
      display: flex;
      margin-bottom: 20px;
      border-bottom: 2px solid #eee;
    }

    .modal-tab {
      flex: 1;
      padding: 10px;
      border: none;
      background: none;
      font-size: 15px;
      cursor: pointer;
      color: #999;
      transition: all 0.3s;
    }

    .modal-tab.active {
      color: #1e3c72;
      border-bottom: 2px solid #1e3c72;
      margin-bottom: -2px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-size: 14px;
    }

    .form-group input {
      width: 100%;
      padding: 12px;
      border: 2px solid #eee;
      border-radius: 10px;
      font-size: 15px;
      transition: border-color 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: #1e3c72;
    }

    .modal-submit {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      color: white;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .modal-submit:hover {
      transform: scale(1.02);
    }

    .modal-submit:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }

    .modal-message {
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 14px;
      text-align: center;
    }

    .modal-message.error {
      background: #ffebee;
      color: #c62828;
    }

    .modal-message.success {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .modal-message.info {
      background: #e3f2fd;
      color: #1565c0;
    }

    .filter-section {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 15px;
      width: 100%;
      max-width: 500px;
    }

    .filter-label {
      color: white;
      font-size: 14px;
      margin-bottom: 8px;
      display: block;
    }

    .category-selector, .importance-selector, .understood-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 10px;
    }

    .category-btn, .importance-btn, .understood-btn {
      padding: 6px 14px;
      border: none;
      border-radius: 20px;
      background: rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 13px;
    }

    .category-btn:hover, .category-btn.active,
    .importance-btn:hover, .importance-btn.active,
    .understood-btn:hover, .understood-btn.active {
      background: rgba(255,255,255,0.9);
      color: #1e3c72;
    }

    .importance-btn[data-importance="high"].active {
      background: #ff6b6b;
      color: white;
    }

    .importance-btn[data-importance="medium"].active {
      background: #ffd93d;
      color: #333;
    }

    .importance-btn[data-importance="low"].active {
      background: #6bcb77;
      color: white;
    }

    .understood-btn[data-understood="checked"].active {
      background: #4CAF50;
      color: white;
    }

    .understood-btn[data-understood="unchecked"].active {
      background: #ff9800;
      color: white;
    }

    .progress {
      color: white;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .card-container {
      perspective: 1000px;
      width: 100%;
      max-width: 420px;
      height: 320px;
      margin-bottom: 15px;
    }

    .card {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s;
      cursor: pointer;
    }

    .card.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .card-front {
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
    }

    .card-back {
      background: linear-gradient(145deg, #ffd700, #ffb700);
      transform: rotateY(180deg);
    }

    .term {
      font-size: 32px;
      font-weight: bold;
      color: #1e3c72;
      text-align: center;
    }

    .category-tag {
      position: absolute;
      top: 15px;
      left: 15px;
      background: #1e3c72;
      color: white;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 12px;
    }

    .importance-tag {
      position: absolute;
      top: 15px;
      right: 15px;
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: bold;
    }

    .importance-tag.high {
      background: #ff6b6b;
      color: white;
    }

    .importance-tag.medium {
      background: #ffd93d;
      color: #333;
    }

    .importance-tag.low {
      background: #6bcb77;
      color: white;
    }

    .definition {
      font-size: 18px;
      color: #333;
      text-align: center;
      line-height: 1.6;
    }

    .hint {
      position: absolute;
      bottom: 15px;
      color: #888;
      font-size: 14px;
    }

    .check-status {
      position: absolute;
      bottom: 50px;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #4CAF50;
      font-size: 16px;
      font-weight: bold;
    }

    .check-status.unchecked {
      color: #999;
    }

    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 30px;
      font-size: 15px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: bold;
    }

    .btn-prev, .btn-next {
      background: white;
      color: #1e3c72;
    }

    .btn-prev:hover, .btn-next:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }

    .btn-shuffle {
      background: #ff6b6b;
      color: white;
    }

    .btn-shuffle:hover {
      background: #ee5a5a;
    }

    .btn-check {
      background: #4CAF50;
      color: white;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn-check:hover {
      background: #45a049;
    }

    .btn-check.checked {
      background: #ff9800;
    }

    .btn-check.checked:hover {
      background: #f57c00;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .keyboard-hint {
      color: rgba(255,255,255,0.7);
      font-size: 13px;
      text-align: center;
      margin-bottom: 10px;
    }

    .progress-bar-container {
      width: 100%;
      max-width: 500px;
      background: rgba(255,255,255,0.2);
      border-radius: 10px;
      height: 24px;
      margin-bottom: 15px;
      overflow: hidden;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50, #8BC34A);
      border-radius: 10px;
      transition: width 0.5s ease;
    }

    .progress-bar-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
    }

    .word-list {
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      padding: 20px;
      margin-top: 10px;
      width: 100%;
      max-width: 700px;
    }

    .word-list h3 {
      color: white;
      margin-bottom: 15px;
      text-align: center;
    }

    .word-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 8px;
      max-height: 400px;
      overflow-y: auto;
    }

    .word-item {
      background: rgba(255,255,255,0.9);
      padding: 8px 10px;
      border-radius: 8px;
      text-align: left;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.3s;
      border-left: 4px solid transparent;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .word-item:hover {
      background: #ffd700;
      transform: scale(1.02);
    }

    .word-item.checked {
      background: #c8e6c9;
    }

    .word-item.high {
      border-left-color: #ff6b6b;
    }

    .word-item.medium {
      border-left-color: #ffd93d;
    }

    .word-item.low {
      border-left-color: #6bcb77;
    }

    .word-item .check-icon {
      font-size: 14px;
      flex-shrink: 0;
    }

    .word-item .word-text {
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .stats {
      color: white;
      text-align: center;
      margin-top: 10px;
      font-size: 14px;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }

    .btn-reset {
      background: #f44336;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      font-size: 13px;
      cursor: pointer;
    }

    .btn-reset:hover {
      background: #d32f2f;
    }

    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
    }

    /* Config Modal */
    .config-banner {
      background: #ff9800;
      color: white;
      padding: 10px 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      width: 100%;
      max-width: 500px;
      text-align: center;
      font-size: 14px;
      cursor: pointer;
    }

    .config-banner:hover {
      background: #f57c00;
    }
  </style>
</head>
<body>
  <!-- Auth Header -->
  <div class="auth-header">
    <div class="user-info" id="userInfo">
      <span id="syncStatus" class="sync-status offline">„É≠„Éº„Ç´„É´‰øùÂ≠ò</span>
      <span id="userEmail"></span>
    </div>
    <button class="auth-btn login" id="loginBtn">„É≠„Ç∞„Ç§„É≥</button>
    <button class="auth-btn logout" id="logoutBtn" style="display:none;">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
  </div>

  <!-- Config Banner (shown when Supabase is not configured) -->
  <div class="config-banner" id="configBanner" style="display:none;" onclick="showConfigModal()">
    SupabaseÊú™Ë®≠ÂÆö - „ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ë®≠ÂÆö
  </div>

  <h1>üö§ „Éú„Éº„Éà„É¨„Éº„ÇπÁî®Ë™û ÂçòË™ûÂ∏≥</h1>
  
  <div class="progress-bar-container">
    <div class="progress-bar" id="progressBar"></div>
    <div class="progress-bar-text" id="progressBarText">0%</div>
  </div>

  <div class="filter-section">
    <span class="filter-label">üìÅ „Ç´„ÉÜ„Ç¥„É™</span>
    <div class="category-selector">
      <button class="category-btn active" data-category="all">„Åô„Åπ„Å¶</button>
      <button class="category-btn" data-category="course">„Ç≥„Éº„Çπ</button>
      <button class="category-btn" data-category="start">„Çπ„Çø„Éº„Éà</button>
      <button class="category-btn" data-category="technique">Ê±∫„Åæ„ÇäÊâã</button>
      <button class="category-btn" data-category="player">ÈÅ∏Êâã</button>
      <button class="category-btn" data-category="betting">ËàüÂà∏</button>
      <button class="category-btn" data-category="equipment">„É¢„Éº„Çø„Éº„ÉªËâá</button>
      <button class="category-btn" data-category="race">„É¨„Éº„Çπ</button>
      <button class="category-btn" data-category="weather">Â§©ÂÄô„ÉªÊ∞¥Èù¢</button>
      <button class="category-btn" data-category="other">„Åù„ÅÆ‰ªñ</button>
    </div>
    
    <span class="filter-label">‚≠ê ÈáçË¶ÅÂ∫¶</span>
    <div class="importance-selector">
      <button class="importance-btn active" data-importance="all">„Åô„Åπ„Å¶</button>
      <button class="importance-btn" data-importance="high">È´òÔºàÂøÖÈ†àÔºâ</button>
      <button class="importance-btn" data-importance="medium">‰∏≠ÔºàÈáçË¶ÅÔºâ</button>
      <button class="importance-btn" data-importance="low">‰ΩéÔºàÂøúÁî®Ôºâ</button>
    </div>

    <span class="filter-label">‚úÖ ÁêÜËß£Â∫¶</span>
    <div class="understood-selector">
      <button class="understood-btn active" data-understood="all">„Åô„Åπ„Å¶</button>
      <button class="understood-btn" data-understood="checked">ÁêÜËß£Ê∏à„Åø</button>
      <button class="understood-btn" data-understood="unchecked">Êú™ÁêÜËß£</button>
    </div>
  </div>

  <div class="progress">
    <span id="current">1</span> / <span id="total">0</span>
  </div>

  <div class="card-container">
    <div class="card" id="card">
      <div class="card-face card-front">
        <span class="category-tag" id="categoryTag">„Ç´„ÉÜ„Ç¥„É™</span>
        <span class="importance-tag" id="importanceTag">ÈáçË¶ÅÂ∫¶</span>
        <div class="term" id="term">Áî®Ë™û</div>
        <div class="check-status unchecked" id="checkStatusFront">
          <span>‚òê</span> Êú™ÁêÜËß£
        </div>
        <span class="hint">„ÇØ„É™„ÉÉ„ÇØ„ÅßÊÑèÂë≥„ÇíË°®Á§∫</span>
      </div>
      <div class="card-face card-back">
        <div class="definition" id="definition">ÊÑèÂë≥</div>
        <div class="check-status unchecked" id="checkStatusBack">
          <span>‚òê</span> Êú™ÁêÜËß£
        </div>
      </div>
    </div>
  </div>

  <div class="controls">
    <button class="btn btn-prev" id="prevBtn">‚óÄ Ââç</button>
    <button class="btn btn-check" id="checkBtn">‚úì ÁêÜËß£„Åó„Åü</button>
    <button class="btn btn-shuffle" id="shuffleBtn">üîÄ</button>
    <button class="btn btn-next" id="nextBtn">Ê¨° ‚ñ∂</button>
  </div>

  <div class="keyboard-hint">
    ‚Üê ‚Üí ÁßªÂãï / Space „ÇÅ„Åè„Çã / Enter ÁêÜËß£„ÉÅ„Çß„ÉÉ„ÇØ
  </div>

  <div class="word-list">
    <h3>üìö Áî®Ë™û‰∏ÄË¶ßÔºà„ÇØ„É™„ÉÉ„ÇØ„Åß„Ç∏„É£„É≥„ÉóÔºâ</h3>
    <div class="word-grid" id="wordGrid"></div>
    <div class="stats" id="stats"></div>
    <div class="action-buttons">
      <button class="btn-reset" id="resetBtn">üóëÔ∏è „ÉÅ„Çß„ÉÉ„ÇØ„Çí„É™„Çª„ÉÉ„Éà</button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Auth Modal -->
  <div class="modal-overlay" id="authModal">
    <div class="modal" style="position:relative;">
      <button class="modal-close" onclick="closeAuthModal()">√ó</button>
      <h2>„Ç¢„Ç´„Ç¶„É≥„Éà</h2>
      <div class="modal-tabs">
        <button class="modal-tab active" data-tab="login">„É≠„Ç∞„Ç§„É≥</button>
        <button class="modal-tab" data-tab="signup">Êñ∞Ë¶èÁôªÈå≤</button>
      </div>
      <div id="authMessage" class="modal-message" style="display:none;"></div>
      <form id="authForm">
        <div class="form-group">
          <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
          <input type="email" id="authEmail" required placeholder="example@email.com">
        </div>
        <div class="form-group">
          <label>„Éë„Çπ„ÉØ„Éº„Éâ</label>
          <input type="password" id="authPassword" required placeholder="6ÊñáÂ≠ó‰ª•‰∏ä" minlength="6">
        </div>
        <button type="submit" class="modal-submit" id="authSubmit">„É≠„Ç∞„Ç§„É≥</button>
      </form>
    </div>
  </div>

  <!-- Config Modal -->
  <div class="modal-overlay" id="configModal">
    <div class="modal" style="position:relative;">
      <button class="modal-close" onclick="closeConfigModal()">√ó</button>
      <h2>Supabase Ë®≠ÂÆö</h2>
      <div id="configMessage" class="modal-message info">
        Supabase Dashboard „Åã„ÇâÂèñÂæó„Åó„ÅüÊÉÖÂ†±„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
      </div>
      <form id="configForm">
        <div class="form-group">
          <label>Project URL</label>
          <input type="url" id="configUrl" required placeholder="https://xxxxx.supabase.co">
        </div>
        <div class="form-group">
          <label>anon public Key</label>
          <input type="text" id="configKey" required placeholder="eyJhbGciOiJIUzI1NiIs...">
        </div>
        <button type="submit" class="modal-submit">‰øùÂ≠ò</button>
      </form>
    </div>
  </div>

  <script>
    // =====================================
    // Supabase Configuration
    // =====================================
    const STORAGE_KEY_CONFIG = 'supabase-config';
    let supabaseClient = null;
    let currentUser = null;

    function getSupabaseConfig() {
      const config = localStorage.getItem(STORAGE_KEY_CONFIG);
      return config ? JSON.parse(config) : null;
    }

    function saveSupabaseConfig(url, key) {
      localStorage.setItem(STORAGE_KEY_CONFIG, JSON.stringify({ url, key }));
    }

    function initSupabase() {
      const config = getSupabaseConfig();
      if (config && config.url && config.key) {
        try {
          supabaseClient = window.supabase.createClient(config.url, config.key);
          document.getElementById('configBanner').style.display = 'none';
          return true;
        } catch (e) {
          console.error('Supabase init error:', e);
        }
      }
      document.getElementById('configBanner').style.display = 'block';
      return false;
    }

    function showConfigModal() {
      const config = getSupabaseConfig();
      if (config) {
        document.getElementById('configUrl').value = config.url || '';
        document.getElementById('configKey').value = config.key || '';
      }
      document.getElementById('configModal').classList.add('show');
    }

    function closeConfigModal() {
      document.getElementById('configModal').classList.remove('show');
    }

    document.getElementById('configForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const url = document.getElementById('configUrl').value.trim();
      const key = document.getElementById('configKey').value.trim();
      
      saveSupabaseConfig(url, key);
      
      if (initSupabase()) {
        closeConfigModal();
        showToast('SupabaseË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
        checkAuthState();
      } else {
        document.getElementById('configMessage').textContent = 'Ë®≠ÂÆö„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇURL„Å®„Ç≠„Éº„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
        document.getElementById('configMessage').className = 'modal-message error';
      }
    });

    // =====================================
    // Authentication
    // =====================================
    function showAuthModal() {
      document.getElementById('authModal').classList.add('show');
      document.getElementById('authMessage').style.display = 'none';
    }

    function closeAuthModal() {
      document.getElementById('authModal').classList.remove('show');
    }

    document.querySelectorAll('.modal-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const isLogin = tab.dataset.tab === 'login';
        document.getElementById('authSubmit').textContent = isLogin ? '„É≠„Ç∞„Ç§„É≥' : 'Êñ∞Ë¶èÁôªÈå≤';
        document.getElementById('authMessage').style.display = 'none';
      });
    });

    document.getElementById('authForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (!supabaseClient) {
        showConfigModal();
        return;
      }

      const email = document.getElementById('authEmail').value;
      const password = document.getElementById('authPassword').value;
      const isLogin = document.querySelector('.modal-tab.active').dataset.tab === 'login';
      const submitBtn = document.getElementById('authSubmit');
      const messageEl = document.getElementById('authMessage');

      submitBtn.disabled = true;
      submitBtn.textContent = 'Âá¶ÁêÜ‰∏≠...';

      try {
        let result;
        if (isLogin) {
          result = await supabaseClient.auth.signInWithPassword({ email, password });
        } else {
          result = await supabaseClient.auth.signUp({ email, password });
        }

        if (result.error) {
          messageEl.textContent = result.error.message;
          messageEl.className = 'modal-message error';
          messageEl.style.display = 'block';
        } else {
          if (!isLogin && !result.data.session) {
            messageEl.textContent = 'Á¢∫Ë™ç„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ„É°„Éº„É´ÂÜÖ„ÅÆ„É™„É≥„ÇØ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ';
            messageEl.className = 'modal-message success';
            messageEl.style.display = 'block';
          } else {
            closeAuthModal();
            showToast('„É≠„Ç∞„Ç§„É≥„Åó„Åæ„Åó„Åü');
            await syncFromCloud();
          }
        }
      } catch (error) {
        messageEl.textContent = '„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message;
        messageEl.className = 'modal-message error';
        messageEl.style.display = 'block';
      }

      submitBtn.disabled = false;
      submitBtn.textContent = isLogin ? '„É≠„Ç∞„Ç§„É≥' : 'Êñ∞Ë¶èÁôªÈå≤';
    });

    async function handleLogout() {
      if (!supabaseClient) return;
      
      await supabaseClient.auth.signOut();
      currentUser = null;
      updateAuthUI();
      showToast('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åó„Åü');
    }

    function updateAuthUI() {
      const loginBtn = document.getElementById('loginBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      const userEmail = document.getElementById('userEmail');
      const syncStatus = document.getElementById('syncStatus');

      if (currentUser) {
        loginBtn.style.display = 'none';
        logoutBtn.style.display = 'block';
        userEmail.textContent = currentUser.email;
        syncStatus.textContent = '„ÇØ„É©„Ç¶„ÉâÂêåÊúü';
        syncStatus.classList.remove('offline');
      } else {
        loginBtn.style.display = 'block';
        logoutBtn.style.display = 'none';
        userEmail.textContent = '';
        syncStatus.textContent = '„É≠„Éº„Ç´„É´‰øùÂ≠ò';
        syncStatus.classList.add('offline');
      }
    }

    async function checkAuthState() {
      if (!supabaseClient) return;

      const { data: { session } } = await supabaseClient.auth.getSession();
      if (session) {
        currentUser = session.user;
        updateAuthUI();
        await syncFromCloud();
      }

      supabaseClient.auth.onAuthStateChange((event, session) => {
        currentUser = session?.user || null;
        updateAuthUI();
        if (event === 'SIGNED_IN') {
          syncFromCloud();
        }
      });
    }

    // =====================================
    // Cloud Sync
    // =====================================
    async function syncFromCloud() {
      if (!supabaseClient || !currentUser) return;

      try {
        const { data, error } = await supabaseClient
          .from('user_progress')
          .select('checked_words')
          .eq('user_id', currentUser.id)
          .single();

        if (error && error.code !== 'PGRST116') {
          console.error('Sync error:', error);
          return;
        }

        if (data && data.checked_words) {
          // Merge cloud data with local data
          const cloudWords = new Set(data.checked_words);
          const localWords = new Set(JSON.parse(localStorage.getItem('boatrace-checked') || '[]'));
          checkedWords = new Set([...cloudWords, ...localWords]);
          saveCheckedWords();
          
          // Upload merged data back to cloud
          await syncToCloud();
          
          filterWords();
          showToast('„Éá„Éº„Çø„ÇíÂêåÊúü„Åó„Åæ„Åó„Åü');
        } else {
          // No cloud data, upload local data
          await syncToCloud();
        }
      } catch (error) {
        console.error('Sync error:', error);
      }
    }

    async function syncToCloud() {
      if (!supabaseClient || !currentUser) return;

      try {
        const checkedArray = [...checkedWords];
        
        const { error } = await supabaseClient
          .from('user_progress')
          .upsert({
            user_id: currentUser.id,
            checked_words: checkedArray,
            updated_at: new Date().toISOString()
          }, {
            onConflict: 'user_id'
          });

        if (error) {
          console.error('Upload error:', error);
        }
      } catch (error) {
        console.error('Upload error:', error);
      }
    }

    // =====================================
    // Word Data
    // =====================================
    const words = [
      // ÈáçË¶ÅÂ∫¶ÔºöÈ´òÔºàÂøÖÈ†àÔºâ
      { term: "„Éî„ÉÉ„Éà", definition: "ÈÅ∏Êâã„Åå„Çπ„Çø„Éº„ÉàÂâç„Å´ÂæÖÊ©ü„Åô„ÇãÂ†¥ÊâÄ„ÄÇ„Åì„Åì„Åã„ÇâÁô∫ÈÄ≤„Åó„Å¶„Ç≥„Éº„ÇπÂèñ„Çä„ÇíË°å„ÅÜ", category: "course", importance: "high" },
      { term: "„Çπ„Çø„Éº„Éà„É©„Ç§„É≥", definition: "„É¨„Éº„ÇπÈñãÂßãÂú∞ÁÇπ„ÄÇÂ§ßÊôÇË®à„Åå0Áßí„ÇíÊåá„Åó„ÅüÁû¨Èñì„Å´ÈÄöÈÅé„Åô„Çã„ÅÆ„ÅåÁêÜÊÉ≥", category: "course", importance: "high" },
      { term: "1„Éû„Éº„ÇØ", definition: "Á¨¨1„Çø„Éº„É≥„Éû„Éº„ÇØ„ÄÇÊúÄÂàù„ÅÆ„Ç≥„Éº„Éä„Éº„ÅßÂãùË≤†„ÅåÊ±∫„Åæ„Çã„Åì„Å®„ÅåÂ§ö„ÅÑÊúÄÈáçË¶Å„Éù„Ç§„É≥„Éà", category: "course", importance: "high" },
      { term: "2„Éû„Éº„ÇØ", definition: "Á¨¨2„Çø„Éº„É≥„Éû„Éº„ÇØ„ÄÇ„Éê„ÉÉ„ÇØ„Çπ„Éà„É¨„ÉÉ„ÉÅÂæå„ÅÆ„Çø„Éº„É≥„Éù„Ç§„É≥„Éà", category: "course", importance: "high" },
      { term: "„Ç≥„Éº„Çπ", definition: "1„Äú6„Ç≥„Éº„Çπ„Åå„ÅÇ„Çä„ÄÅÂÜÖÂÅ¥„Åª„Å©ÊúâÂà©„ÄÇ1„Ç≥„Éº„Çπ„ÅÆÂãùÁéá„ÅØÁ¥Ñ55%", category: "course", importance: "high" },
      { term: "„Ç§„É≥„Ç≥„Éº„Çπ", definition: "1„Äú3„Ç≥„Éº„Çπ„ÅÆÂÜÖÂÅ¥„Ç≥„Éº„Çπ„ÄÇ„Çπ„Çø„Éº„Éà„ÅßÊúâÂà©„Å†„ÅåÊäÄË°ì„ÅåÂøÖË¶Å", category: "course", importance: "high" },
      { term: "„Ç¢„Ç¶„Éà„Ç≥„Éº„Çπ", definition: "4„Äú6„Ç≥„Éº„Çπ„ÅÆÂ§ñÂÅ¥„Ç≥„Éº„Çπ„ÄÇÂä©Ëµ∞Ë∑ùÈõ¢„ÇíÂèñ„Çå„Çã„Åå„Çø„Éº„É≥„Åß‰∏çÂà©", category: "course", importance: "high" },
      { term: "„Éõ„Éº„É†„Çπ„Éà„É¨„ÉÉ„ÉÅ", definition: "„Çπ„Çø„É≥„ÉâÂâç„ÅÆÁõ¥Á∑öÈÉ®ÂàÜ„ÄÇ„Ç¥„Éº„É´„É©„Ç§„É≥„ÇÇ„Åì„Åì„Å´„ÅÇ„Çã", category: "course", importance: "high" },
      { term: "„Éê„ÉÉ„ÇØ„Çπ„Éà„É¨„ÉÉ„ÉÅ", definition: "1„Éû„Éº„ÇØ„Å®2„Éû„Éº„ÇØ„ÅÆÈñì„ÅÆÁõ¥Á∑öÈÉ®ÂàÜ", category: "course", importance: "high" },
      { term: "„Éï„É©„Ç§„É≥„Ç∞„Çπ„Çø„Éº„ÉàÊñπÂºè", definition: "Ê±∫„ÇÅ„Çâ„Çå„ÅüÊôÇÈñìÂÜÖ„Å´„Çπ„Çø„Éº„Éà„É©„Ç§„É≥„ÇíÈÄöÈÅé„Åô„ÇãÊñπÂºè„ÄÇÈô∏‰∏ä„Å®ÈÅï„ÅÑÈùôÊ≠¢Áä∂ÊÖã„Åã„ÇâÂßã„Åæ„Çâ„Å™„ÅÑ", category: "start", importance: "high" },
      { term: "Â§ßÊôÇË®à", definition: "„Çπ„Çø„Éº„Éà„Çø„Ç§„Éü„É≥„Ç∞„ÇíÁ§∫„ÅôÊôÇË®à„ÄÇ12ÁßíÂâç„Åã„ÇâÂãï„ÅçÂßã„ÇÅ„ÄÅ0Áßí„Åß„Çπ„Çø„Éº„Éà", category: "start", importance: "high" },
      { term: "„Éï„É©„Ç§„É≥„Ç∞ÔºàFÔºâ", definition: "„Çπ„Çø„Éº„ÉàÊôÇÂàª„Çà„ÇäÊó©„ÅèÈÄöÈÅé„Åó„ÅüÈÅïÂèç„ÄÇ„Åù„ÅÆÈÅ∏Êâã„ÅØÂ§±Ê†º„ÄÅËàüÂà∏„ÅØËøîÈÇÑ", category: "start", importance: "high" },
      { term: "Âá∫ÈÅÖ„ÇåÔºàLÔºâ", definition: "„Çπ„Çø„Éº„ÉàÊôÇÂàª„Åã„Çâ1Áßí‰ª•‰∏äÈÅÖ„Çå„ÅüÈÅïÂèç„ÄÇÂ§±Ê†ºÊâ±„ÅÑ„ÅßËàüÂà∏ËøîÈÇÑ", category: "start", importance: "high" },
      { term: "„Çπ„Çø„Éº„Éà„Çø„Ç§„Éü„É≥„Ç∞ÔºàSTÔºâ", definition: "„Çπ„Çø„Éº„Éà„É©„Ç§„É≥„ÇíÈÄöÈÅé„Åó„ÅüÊôÇ„ÅÆ„Çø„Ç§„É†„ÄÇ0.00„Å´Ëøë„ÅÑ„Åª„Å©ËâØ„ÅÑ„Çπ„Çø„Éº„Éà", category: "start", importance: "high" },
      { term: "Âπ≥ÂùáST", definition: "ÈÅ∏Êâã„ÅÆ„Çπ„Çø„Éº„Éà„Çø„Ç§„Éü„É≥„Ç∞„ÅÆÂπ≥ÂùáÂÄ§„ÄÇ‰Ωé„ÅÑ„Åª„Å©„Çπ„Çø„Éº„Éà„Åå‰∏äÊâã„ÅÑ", category: "start", importance: "high" },
      { term: "ÂæÖÊ©üË°åÂãï", definition: "„Éî„ÉÉ„Éà„Ç¢„Ç¶„Éà„Åã„Çâ„Çπ„Çø„Éº„Éà„Åæ„Åß„ÅÆÂãï„Åç„ÄÇ„Ç≥„Éº„ÇπÂèñ„Çä„ÅÆÈßÜ„ÅëÂºï„Åç„ÅåË°å„Çè„Çå„Çã", category: "start", importance: "high" },
      { term: "ÈÄ≤ÂÖ•", definition: "„Çπ„Çø„Éº„ÉàÁõ¥Ââç„ÅÆ„Ç≥„Éº„Çπ‰ΩçÁΩÆÂèñ„Çä„ÄÇÊû†Áï™ÈÄö„Çä„Å®„ÅØÈôê„Çâ„Å™„ÅÑ", category: "start", importance: "high" },
      { term: "ÈÄÉ„Åí", definition: "1„Ç≥„Éº„Çπ„ÅÆËâá„ÅåÂÖàË°å„Åó„Å¶„Åù„ÅÆ„Åæ„Åæ1ÁùÄ„Åß„Ç¥„Éº„É´„ÄÇÊúÄ„ÇÇÂ§ö„ÅÑÊ±∫„Åæ„ÇäÊâã", category: "technique", importance: "high" },
      { term: "Â∑Æ„Åó", definition: "ÂÜÖÂÅ¥„Åã„Çâ‰ªñËâá„ÇíËøΩ„ÅÑÊäú„ÅÑ„Å¶Âãù„Å§Ê±∫„Åæ„ÇäÊâã„ÄÇ2„Äú4„Ç≥„Éº„Çπ„Å´Â§ö„ÅÑ", category: "technique", importance: "high" },
      { term: "„Åæ„Åè„Çä", definition: "Â§ñÂÅ¥„Åã„Çâ‰∏ÄÊ∞ó„Å´ËøΩ„ÅÑÊäú„ÅÑ„Å¶Âãù„Å§Ê±∫„Åæ„ÇäÊâã„ÄÇ„Çπ„Éî„Éº„Éâ„Å®ÊäÄË°ì„ÅåÂøÖË¶Å", category: "technique", importance: "high" },
      { term: "„Åæ„Åè„ÇäÂ∑Æ„Åó", definition: "Â§ñ„Åã„Çâ„Åæ„Åè„Çä„Å™„Åå„ÇâÂÜÖÂÅ¥„Å´Âàá„ÇäËæº„Çì„ÅßÂãù„Å§È´òÂ∫¶„Å™ÊäÄ„ÄÇ4„Äú6„Ç≥„Éº„Çπ„ÅßË¶ã„Çâ„Çå„Çã", category: "technique", importance: "high" },
      { term: "Êäú„Åç", definition: "2Âë®ÁõÆ‰ª•Èôç„ÅÆ„Çπ„Éà„É¨„Éº„Éà„ÇÑ„Çø„Éº„É≥„ÅßËøΩ„ÅÑÊäú„ÅÑ„Å¶Âãù„Å§Ê±∫„Åæ„ÇäÊâã", category: "technique", importance: "high" },
      { term: "ÊÅµ„Åæ„Çå", definition: "‰ªñËâá„ÅÆ„Éï„É©„Ç§„É≥„Ç∞„ÉªËª¢Ë¶Ü„ÉªÂ§±Ê†º„Å™„Å©„ÅßÈ†Ü‰Ωç„ÅåÁπ∞„Çä‰∏ä„Åå„ÇãÊ±∫„Åæ„ÇäÊâã", category: "technique", importance: "high" },
      { term: "A1Á¥ö", definition: "ÈÅ∏Êâã„ÅÆÊúÄ‰∏ä‰Ωç„É©„É≥„ÇØ„ÄÇÂãùÁéá‰∏ä‰ΩçÁ¥Ñ20%„ÅÆÈÅ∏Êâã„ÄÇË≥ûÈáë„ÇÇÈ´ò„ÅÑ", category: "player", importance: "high" },
      { term: "A2Á¥ö", definition: "ÈÅ∏Êâã„ÅÆ2Áï™ÁõÆ„ÅÆ„É©„É≥„ÇØ„ÄÇA1„Å´Ê¨°„ÅêÂÆüÂäõËÄÖ", category: "player", importance: "high" },
      { term: "B1Á¥ö", definition: "ÈÅ∏Êâã„ÅÆ3Áï™ÁõÆ„ÅÆ„É©„É≥„ÇØ„ÄÇ‰∏≠Â†Ö„ÇØ„É©„Çπ", category: "player", importance: "high" },
      { term: "B2Á¥ö", definition: "ÈÅ∏Êâã„ÅÆÊúÄ‰∏ã‰Ωç„É©„É≥„ÇØ„ÄÇÊñ∞‰∫∫„ÇÑÊàêÁ∏æ‰∏çÊåØ„ÅÆÈÅ∏Êâã", category: "player", importance: "high" },
      { term: "ÂãùÁéá", definition: "ÈÅ∏Êâã„ÅÆÊàêÁ∏æ„ÇíÁ§∫„ÅôÊï∞ÂÄ§„ÄÇÁùÄÈ†ÜÁÇπ„ÅÆÂêàË®à√∑Âá∫Ëµ∞ÂõûÊï∞„ÅßË®àÁÆó", category: "player", importance: "high" },
      { term: "2ÈÄ£ÂØæÁéá", definition: "2ÁùÄ‰ª•ÂÜÖ„Å´ÂÖ•„ÇãÁ¢∫Áéá„ÄÇÈÅ∏Êâã„ÅÆÂÆâÂÆöÊÑü„ÇíÁ§∫„ÅôÈáçË¶ÅÊåáÊ®ô", category: "player", importance: "high" },
      { term: "3ÈÄ£ÂØæÁéá", definition: "3ÁùÄ‰ª•ÂÜÖ„Å´ÂÖ•„ÇãÁ¢∫Áéá„ÄÇËàüÂà∏„Å´Áµ°„ÇÄÂèØËÉΩÊÄß„ÇíÁ§∫„Åô", category: "player", importance: "high" },
      { term: "3ÈÄ£Âçò", definition: "1ÁùÄ„Éª2ÁùÄ„Éª3ÁùÄ„ÇíÁùÄÈ†ÜÈÄö„Çä„Å´ÂΩì„Å¶„ÇãËàüÂà∏„ÄÇ120ÈÄö„Çä„ÅßÈ´òÈÖçÂΩì„ÅåÁãô„Åà„Çã", category: "betting", importance: "high" },
      { term: "3ÈÄ£Ë§á", definition: "1ÁùÄ„Éª2ÁùÄ„Éª3ÁùÄ„ÇíÈ†Ü‰∏çÂêå„ÅßÂΩì„Å¶„ÇãËàüÂà∏„ÄÇ20ÈÄö„Çä", category: "betting", importance: "high" },
      { term: "2ÈÄ£Âçò", definition: "1ÁùÄ„Éª2ÁùÄ„ÇíÁùÄÈ†ÜÈÄö„Çä„Å´ÂΩì„Å¶„ÇãËàüÂà∏„ÄÇ30ÈÄö„Çä", category: "betting", importance: "high" },
      { term: "2ÈÄ£Ë§á", definition: "1ÁùÄ„Éª2ÁùÄ„ÇíÈ†Ü‰∏çÂêå„ÅßÂΩì„Å¶„ÇãËàüÂà∏„ÄÇ15ÈÄö„Çä", category: "betting", importance: "high" },
      { term: "ÂçòÂãù", definition: "1ÁùÄ„ÇíÂΩì„Å¶„ÇãËàüÂà∏„ÄÇ6ÈÄö„Çä„ÅßÂàùÂøÉËÄÖÂêë„Åë", category: "betting", importance: "high" },
      { term: "Ë§áÂãù", definition: "2ÁùÄ‰ª•ÂÜÖ„ÇíÂΩì„Å¶„ÇãËàüÂà∏„ÄÇÁöÑ‰∏≠„Åó„ÇÑ„Åô„ÅÑ„ÅåÈÖçÂΩì„ÅØ‰Ωé„ÇÅ", category: "betting", importance: "high" },
      { term: "Êã°ÈÄ£Ë§áÔºà„ÉØ„Ç§„ÉâÔºâ", definition: "3ÁùÄ‰ª•ÂÜÖ„ÅÆ2Ëâá„ÇíÂΩì„Å¶„ÇãËàüÂà∏„ÄÇ15ÈÄö„Çä„ÅßÁöÑ‰∏≠„Åó„ÇÑ„Åô„ÅÑ", category: "betting", importance: "high" },
      { term: "„Ç™„ÉÉ„Ç∫", definition: "ÈÖçÂΩìÂÄçÁéá„ÄÇ‰∫∫Ê∞ó„Åå„Å™„ÅÑ„Åª„Å©È´ò„Åè„Å™„Çä„ÄÅÁ∑†ÂàáÁõ¥Ââç„Åæ„ÅßÂ§âÂãï„Åô„Çã", category: "betting", importance: "high" },
      { term: "Êú¨ÂëΩ", definition: "1Áï™‰∫∫Ê∞ó„ÅßÂãù„Å§ÂèØËÉΩÊÄß„ÅåÈ´ò„ÅÑ„Å®„Åï„Çå„ÇãËâá", category: "betting", importance: "high" },
      { term: "Á©¥", definition: "‰∫∫Ê∞ó„Åå„Å™„ÅÑ„ÅåÈ´òÈÖçÂΩì„ÅåÊúüÂæÖ„Åß„Åç„ÇãËâá„ÄÇ‰∏áËàüÂà∏„ÅÆÂèØËÉΩÊÄß", category: "betting", importance: "high" },
      { term: "„É¢„Éº„Çø„Éº", definition: "„Ç®„É≥„Ç∏„É≥„ÅÆ„Åì„Å®„ÄÇ„É¨„Éº„ÇπÂ†¥„Åî„Å®„Å´‰øùÊúâ„Åó„ÄÅÁØÄ„ÅÆÂàùÊó•„Å´ÊäΩÈÅ∏„ÅßÊ±∫„Åæ„Çã", category: "equipment", importance: "high" },
      { term: "„Éú„Éº„ÉàÔºàËâáÔºâ", definition: "„É¨„Éº„Çπ„Åß‰ΩøÁî®„Åô„ÇãËàπ„ÄÇ„É¢„Éº„Çø„Éº„Å®ÂêåÊßò„Å´ÊäΩÈÅ∏„ÅßÂâ≤„ÇäÂΩì„Å¶", category: "equipment", importance: "high" },
      { term: "„É¢„Éº„Çø„Éº2ÈÄ£ÂØæÁéá", definition: "„Åù„ÅÆ„É¢„Éº„Çø„Éº„Çí‰ΩøÁî®„Åó„ÅüÈÅ∏Êâã„ÅÆ2ÁùÄ‰ª•ÂÜÖÁéá„ÄÇÊ©üÂäõ„ÅÆÊåáÊ®ô", category: "equipment", importance: "high" },
      { term: "„Éó„É≠„Éö„É©", definition: "Êé®ÈÄ≤Âäõ„ÇíÁîü„ÇÄ„Éë„Éº„ÉÑ„ÄÇÈÅ∏Êâã„ÅåËá™ÂàÜ„ÅßË™øÊï¥„Éª‰∫§ÊèõÂèØËÉΩ", category: "equipment", importance: "high" },
      { term: "SGÔºà„Çπ„Éö„Ç∑„É£„É´„Ç∞„É¨„Éº„ÉâÔºâ", definition: "ÊúÄÈ´òÂ≥∞„ÅÆ„Ç∞„É¨„Éº„Éâ„É¨„Éº„Çπ„ÄÇ„Ç∞„É©„É≥„Éó„É™„ÄÅ„ÇØ„É©„Ç∑„ÉÉ„ÇØ„Å™„Å©Âπ¥Èñì9Êà¶", category: "race", importance: "high" },
      { term: "G1", definition: "SG„Å´Ê¨°„Åê„Ç∞„É¨„Éº„Éâ„É¨„Éº„Çπ„ÄÇÂë®Âπ¥Ë®òÂøµ„ÄÅÂú∞Âå∫ÈÅ∏ÊâãÊ®©„Å™„Å©", category: "race", importance: "high" },
      { term: "‰∏ÄËà¨Êà¶", definition: "„Ç∞„É¨„Éº„Éâ„Å™„Åó„ÅÆÈÄöÂ∏∏„É¨„Éº„Çπ„ÄÇÊúÄ„ÇÇÈñãÂÇ¨Êï∞„ÅåÂ§ö„ÅÑ", category: "race", importance: "high" },
      { term: "ÁØÄ", definition: "Êï∞Êó•Èñì„Å´„Çè„Åü„ÇãÈñãÂÇ¨Âçò‰Ωç„ÄÇÈÄöÂ∏∏4„Äú7Êó•Èñì", category: "race", importance: "high" },
      { term: "‰∫àÈÅ∏", definition: "ÁØÄ„ÅÆÂ∫èÁõ§„Å´Ë°å„Çè„Çå„Çã„É¨„Éº„Çπ„ÄÇÂæóÁÇπ„ÇíÁ´∂„ÅÑ‰∏ä‰Ωç„ÅåÊ∫ñÂÑ™ÂãùÊà¶„Å∏", category: "race", importance: "high" },
      { term: "ÂÑ™ÂãùÊà¶", definition: "ÁØÄ„ÅÆÊúÄÁµÇÊó•„Å´Ë°å„Çè„Çå„ÇãÊ±∫Âãù„É¨„Éº„Çπ„ÄÇ‰∏ä‰Ωç6Âêç„Åß‰∫â„ÅÜ", category: "race", importance: "high" },

      // ÈáçË¶ÅÂ∫¶Ôºö‰∏≠ÔºàÈáçË¶ÅÔºâ
      { term: "Ê∞¥Èù¢", definition: "„É¨„Éº„Çπ„ÅåË°å„Çè„Çå„ÇãÁ´∂Ëµ∞Ê∞¥Èù¢„ÅÆ„Åì„Å®„ÄÇÂêÑÂ†¥„ÅßÁâπÂæ¥„ÅåÁï∞„Å™„Çã", category: "course", importance: "medium" },
      { term: "„Çª„É≥„Çø„Éº„Ç≥„Éº„Çπ", definition: "3„Äú4„Ç≥„Éº„Çπ„ÅÆ„Åì„Å®„ÄÇ„Ç§„É≥„Éª„Ç¢„Ç¶„Éà„ÅÆ‰∏≠ÈñìÁöÑ„Å™‰ΩçÁΩÆ", category: "course", importance: "medium" },
      { term: "Â§ßÂ§ñ", definition: "6„Ç≥„Éº„Çπ„ÅÆ„Åì„Å®„ÄÇÊúÄ„ÇÇÂ§ñÂÅ¥„Åß‰∏çÂà©„Å®„Åï„Çå„Çã", category: "course", importance: "medium" },
      { term: "„Çπ„Çø„Éº„ÉàÂ±ïÁ§∫", definition: "Êú¨Áï™Ââç„Å´Ë°å„ÅÜ„Çπ„Çø„Éº„Éà„ÅÆÁ∑¥Áøí„ÉªÂÖ¨Èñã„ÄÇ„Çπ„Çø„Éº„ÉàÂäõ„ÅÆÂèÇËÄÉ„Å´„Å™„Çã", category: "start", importance: "medium" },
      { term: "„Ç≥„Éº„ÇπÂèñ„Çä", definition: "„Çπ„Çø„Éº„ÉàÂâç„Å´„Å©„ÅÆ„Ç≥„Éº„Çπ„ÇíÂèñ„Çã„Åã„ÅÆÈßÜ„ÅëÂºï„Åç", category: "start", importance: "medium" },
      { term: "„Çπ„É≠„Éº„Çπ„Çø„Éº„Éà", definition: "Âä©Ëµ∞Ë∑ùÈõ¢„ÇíÁü≠„Åè„Åó„Å¶ÂÜÖÂÅ¥„Åã„ÇâÂá∫„Çã„Çπ„Çø„Éº„Éà„ÄÇ„Ç§„É≥„Ç≥„Éº„ÇπÂêë„Åë", category: "start", importance: "medium" },
      { term: "„ÉÄ„ÉÉ„Ç∑„É•„Çπ„Çø„Éº„Éà", definition: "Âä©Ëµ∞Ë∑ùÈõ¢„ÇíÈï∑„Åè„Åó„Å¶Â§ñÂÅ¥„Åã„ÇâÂã¢„ÅÑ„Çà„ÅèÂá∫„Çã„Çπ„Çø„Éº„Éà", category: "start", importance: "medium" },
      { term: "„Ç´„Éâ", definition: "„Çπ„É≠„ÉºÂã¢„Å®„ÉÄ„ÉÉ„Ç∑„É•Âã¢„ÅÆÂ¢ÉÁõÆ„ÄÇÈÄöÂ∏∏4„Ç≥„Éº„Çπ„ÅåÂ§ö„ÅÑ", category: "start", importance: "medium" },
      { term: "Ââç„Å•„Åë", definition: "Â§ñÊû†„ÅÆÈÅ∏Êâã„ÅåÂÜÖÂÅ¥„ÅÆ„Ç≥„Éº„Çπ„ÇíÂ•™„ÅÑ„Å´Ë°å„ÅèË°åÁÇ∫", category: "start", importance: "medium" },
      { term: "Ë°å„ÅçË∂≥", definition: "„Çπ„Çø„Éº„Éà„Åã„Çâ1„Éû„Éº„ÇØ„Åæ„Åß„ÅÆÂä†ÈÄüÂäõ", category: "start", importance: "medium" },
      { term: "„ÉÑ„Ç±„Éû„Ç§", definition: "ÂÜÖÂÅ¥„ÅÆËâá„Å´Êé•Ëøë„Åó„Å¶„Çø„Éº„É≥„Åó„ÄÅÂºï„ÅçÊ≥¢„ÅßÂ§±ÈÄü„Åï„Åõ„ÇãÊäÄ", category: "technique", importance: "medium" },
      { term: "„É¢„É≥„Ç≠„Éº„Çø„Éº„É≥", definition: "Ëâá„ÅÆ‰∏ä„Å´Á´ã„Å°‰∏ä„Åå„Å£„Å¶Èã≠„Åè„Çø„Éº„É≥„Åô„ÇãÊäÄË°ì„ÄÇÁèæ‰ª£„ÅÆ‰∏ªÊµÅ", category: "technique", importance: "medium" },
      { term: "Âºï„ÅçÊ≥¢", definition: "Ëâá„ÅåÈÄ≤„ÇÄÈöõ„Å´ÂæåÊñπ„Å´„Åß„Åç„ÇãÊ≥¢„ÄÇÂæåÁ∂öËâá„ÅÆËµ∞„Çä„Å´ÂΩ±Èüø", category: "technique", importance: "medium" },
      { term: "Âõû„ÇäË∂≥", definition: "„Çø„Éº„É≥„ÅÆÂõû„Çä„ÇÑ„Åô„Åï„ÄÇÊóãÂõûÊÄßËÉΩ„ÅÆ„Åì„Å®", category: "technique", importance: "medium" },
      { term: "Âá∫Ë∂≥", definition: "„Çπ„Çø„Éº„Éà„Åã„Çâ„ÅÆÂä†ÈÄüÂäõ„ÄÇ‰ΩéÈÄüÂüü„Åß„ÅÆ‰º∏„Å≥", category: "technique", importance: "medium" },
      { term: "‰º∏„Å≥", definition: "Áõ¥Á∑ö„Åß„ÅÆÊúÄÈ´òÈÄü„ÄÇ„Éà„ÉÉ„Éó„Çπ„Éî„Éº„Éâ„ÅÆ„Åì„Å®", category: "technique", importance: "medium" },
      { term: "Êû†Áï™", definition: "1„Äú6„ÅÆÂá∫Ëµ∞Áï™Âè∑„ÄÇÈÄöÂ∏∏„Åì„ÅÆÁï™Âè∑„ÅÆ„Ç≥„Éº„Çπ„Åã„Çâ„Çπ„Çø„Éº„Éà", category: "player", importance: "medium" },
      { term: "„Ç§„É≥Â±ã", definition: "1„Ç≥„Éº„ÇπÔºàÂÜÖÂÅ¥Ôºâ„ÇíÂ•Ω„ÇÄÈÅ∏Êâã„ÄÇÂâç„Å•„Åë„ÅåÂæóÊÑè", category: "player", importance: "medium" },
      { term: "Âú∞ÂÖÉÈÅ∏Êâã", definition: "„Åù„ÅÆ„É¨„Éº„ÇπÂ†¥„ÇíÊú¨Êã†Âú∞„Å®„Åô„ÇãÈÅ∏Êâã„ÄÇÊ∞¥Èù¢„ÇíÁÜüÁü•", category: "player", importance: "medium" },
      { term: "‰∏áËàüÂà∏", definition: "ÈÖçÂΩì„Åå1‰∏áÂÜÜ„ÇíË∂Ö„Åà„ÇãËàüÂà∏„ÄÇ100ÂÄç‰ª•‰∏ä„ÅÆ„Ç™„ÉÉ„Ç∫", category: "betting", importance: "medium" },
      { term: "Ëª∏", definition: "‰∫àÊÉ≥„ÅÆ‰∏≠ÂøÉ„Å®„Å™„ÇãËâá„ÄÇËª∏„ÇíÊ±∫„ÇÅ„Å¶ÊµÅ„Åô„ÅÆ„ÅåÂü∫Êú¨", category: "betting", importance: "medium" },
      { term: "ÊµÅ„Åó", definition: "Ëª∏„ÇíÊ±∫„ÇÅ„Å¶‰ªñ„ÅÆËâá„ÇíÁõ∏Êâã„Å´Ë§áÊï∞Ë≤∑„ÅÜÊñπÊ≥ï", category: "betting", importance: "medium" },
      { term: "„Éú„ÉÉ„ÇØ„Çπ", definition: "ÈÅ∏„Çì„Å†Ëâá„ÅÆÂÖ®ÁµÑ„ÅøÂêà„Çè„Åõ„ÇíË≤∑„ÅÜÊñπÊ≥ï", category: "betting", importance: "medium" },
      { term: "ÂõûÂèéÁéá", definition: "ÊäïË≥áÈáëÈ°ç„Å´ÂØæ„Åô„ÇãÊâïÊàªÈáëÈ°ç„ÅÆÂâ≤Âêà„ÄÇ100%‰ª•‰∏ä„Åß„Éó„É©„Çπ", category: "betting", importance: "medium" },
      { term: "„ÉÅ„É´„ÉàËßíÂ∫¶", definition: "„É¢„Éº„Çø„Éº„ÅÆÂèñ„Çä‰ªò„ÅëËßíÂ∫¶„ÄÇ-0.5„Äú+3.0Â∫¶„ÅßË™øÊï¥ÂèØËÉΩ", category: "equipment", importance: "medium" },
      { term: "ÈÉ®ÂìÅ‰∫§Êèõ", definition: "„É¢„Éº„Çø„Éº„ÅÆÈÉ®ÂìÅ„Çí‰∫§Êèõ„Åô„Çã„Åì„Å®„ÄÇÊï¥ÂÇô„ÅÆ‰∏ÄÁí∞", category: "equipment", importance: "medium" },
      { term: "Ê©üÂäõ", definition: "„É¢„Éº„Çø„Éº„ÅÆÊÄßËÉΩ„ÄÇÂãùÊïó„ÇíÂ∑¶Âè≥„Åô„ÇãÈáçË¶ÅË¶ÅÁ¥†", category: "equipment", importance: "medium" },
      { term: "G2", definition: "G1„Å´Ê¨°„Åê„Ç∞„É¨„Éº„Éâ„É¨„Éº„Çπ„ÄÇ„É¢„Éº„Çø„Éº„Éú„Éº„ÉàÂ§ßË≥û„Å™„Å©", category: "race", importance: "medium" },
      { term: "Ê∫ñÂÑ™ÂãùÊà¶", definition: "‰∫àÈÅ∏‰∏ä‰ΩçËÄÖ„Å´„Çà„ÇãÊ∫ñÊ±∫Âãù„ÄÇ‰∏ä‰Ωç2Âêç„ÅåÂÑ™ÂãùÊà¶„Å∏", category: "race", importance: "medium" },
      { term: "„Éä„Ç§„Çø„Éº", definition: "Â§úÈñìÈñãÂÇ¨„ÅÆ„É¨„Éº„Çπ„ÄÇÁÖßÊòé‰∏ã„ÅßË°å„Çè„Çå„Çã", category: "race", importance: "medium" },
      { term: "ËøΩ„ÅÑÈ¢®", definition: "„Çπ„Çø„Éº„ÉàÊñπÂêë„Å´Âêπ„ÅèÈ¢®„ÄÇ„Çπ„Çø„Éº„Éà„ÅåÊó©„Åè„Å™„Çä„ÇÑ„Åô„ÅÑ", category: "weather", importance: "medium" },
      { term: "Âêë„Åã„ÅÑÈ¢®", definition: "„Çπ„Çø„Éº„Éà„Å®ÈÄÜÊñπÂêë„ÅÆÈ¢®„ÄÇ„Çπ„Çø„Éº„Éà„ÅåÈÅÖ„Çå„ÇÑ„Åô„ÅÑ", category: "weather", importance: "medium" },
      { term: "Ê≥¢È´ò", definition: "Ê≥¢„ÅÆÈ´ò„Åï„ÄÇÈ´ò„ÅÑ„Å®„Çø„Éº„É≥„ÅåÈõ£„Åó„Åè„Å™„Çã", category: "weather", importance: "medium" },
      { term: "ÈùôÊ∞¥Èù¢", definition: "Ê≥¢„ÅåÁ©è„ÇÑ„Åã„Å™Ê∞¥Èù¢Áä∂ÊÖã„ÄÇÊäÄË°ìÂ∑Æ„ÅåÂá∫„ÇÑ„Åô„ÅÑ", category: "weather", importance: "medium" },
      { term: "ÊΩÆ", definition: "Êµ∑Ê∞¥„ÇíÂà©Áî®„Åô„ÇãÁ´∂ËâáÂ†¥„Åß„ÅÆÊΩÆ„ÅÆÊ∫Ä„Å°Âºï„Åç", category: "weather", importance: "medium" },

      // ÈáçË¶ÅÂ∫¶Ôºö‰ΩéÔºàÂøúÁî®Ôºâ
      { term: "Â±ïÁ§∫„Éî„ÉÉ„Éà", definition: "Â±ïÁ§∫Ëà™Ëµ∞ÊôÇ„Å´ÈÅ∏Êâã„ÅåÂæÖÊ©ü„Åô„ÇãÂ†¥ÊâÄ", category: "course", importance: "low" },
      { term: "Â§ßÂõû„Çä", definition: "„Çø„Éº„É≥„Éû„Éº„ÇØ„ÇíÂ§ß„Åç„ÅèÂõû„Çã„Åì„Å®„ÄÇ„Çø„Ç§„É†„É≠„Çπ„Å´„Å™„Çã", category: "course", importance: "low" },
      { term: "Â∞èÂõû„Çä", definition: "„Çø„Éº„É≥„Éû„Éº„ÇØ„ÇíÂ∞è„Åï„ÅèÂõû„Çã„Åì„Å®„ÄÇÂäπÁéáÁöÑ", category: "course", importance: "low" },
      { term: "12ÁßíÈáù", definition: "Â§ßÊôÇË®à„ÅÆÈï∑Èáù„ÄÇ12ÁßíÂâç„Åã„ÇâÂãï„ÅçÂßã„ÇÅ„Çã", category: "start", importance: "low" },
      { term: "F‰ºë„Åø", definition: "„Éï„É©„Ç§„É≥„Ç∞„Å´„Çà„ÇãÂá∫Â†¥ÂÅúÊ≠¢ÊúüÈñì", category: "start", importance: "low" },
      { term: "„Çπ„É™„ÉÉ„Éà", definition: "„Çπ„Çø„Éº„Éà„É©„Ç§„É≥„Å®Âêå„Åò‰ΩçÁΩÆ„ÅÆÊ®™‰∏¶„Å≥Áä∂ÊÖã", category: "start", importance: "low" },
      { term: "ÂÖ®ÈÄü„Çø„Éº„É≥", definition: "„Çπ„É≠„ÉÉ„Éà„É´„ÇíÂÖ®Èñã„Å´„Åó„Åü„Åæ„Åæ„Çø„Éº„É≥„Åô„ÇãÊäÄË°ì", category: "technique", importance: "low" },
      { term: "„Ç≠„É£„Éì„Çã", definition: "„Éó„É≠„Éö„É©„Å´Á©∫Ê∞ó„ÅåÂÖ•„ÇäÊé®ÈÄ≤Âäõ„ÅåËêΩ„Å°„Çã„Åì„Å®", category: "technique", importance: "low" },
      { term: "„Åã„Å∂„Çã", definition: "‰ªñËâá„ÅÆÂºï„ÅçÊ≥¢„ÇíÂèó„Åë„Å¶Â§±ÈÄü„Åô„Çã„Åì„Å®", category: "technique", importance: "low" },
      { term: "È§äÊàêÊâÄ", definition: "ÈÅ∏Êâã„ÇíÈ§äÊàê„Åô„ÇãÊñΩË®≠„ÄÇÁ¶èÂ≤°ÁúåÊü≥Â∑ùÂ∏Ç„Å´„ÅÇ„Çã", category: "player", importance: "low" },
      { term: "„Éï„É©„Ç§„É≥„Ç∞ÊåÅ„Å°", definition: "Áõ¥Ëøë„Åß„Éï„É©„Ç§„É≥„Ç∞„Çí„Åó„ÅüÈÅ∏Êâã„ÄÇÊÖéÈáç„Å´„Å™„Çä„ÇÑ„Åô„ÅÑ", category: "player", importance: "low" },
      { term: "„Çπ„Çø„Éº„ÉàÂ∑ßËÄÖ", definition: "„Çπ„Çø„Éº„Éà„Åå‰∏äÊâã„ÅÑÈÅ∏Êâã", category: "player", importance: "low" },
      { term: "ÁâπÊâï„ÅÑ", definition: "ÂØæË±°„ÅÆËàüÂà∏„ÅåÂÖ®„Å¶‰∏çÁöÑ‰∏≠„ÅÆÂ†¥Âêà„ÅÆÊâïÊàª„Åó„ÄÇ70ÂÜÜ", category: "betting", importance: "low" },
      { term: "„Éà„É™„Ç¨„Éü", definition: "ÁöÑ‰∏≠„Åó„Åü„ÅåÈÖçÂΩì„ÅåË≥ºÂÖ•ÈáëÈ°ç„Çí‰∏ãÂõû„Çã„Åì„Å®", category: "betting", importance: "low" },
      { term: "„ÉÜ„É¨„Éú„Éº„Éà", definition: "ÈõªË©±„Éª„Ç§„É≥„Çø„Éº„Éç„ÉÉ„ÉàÊäïÁ•®„Çµ„Éº„Éì„Çπ", category: "betting", importance: "low" },
      { term: "„Ç∑„É™„É≥„ÉÄ„Éº„Ç±„Éº„Çπ", definition: "„Ç®„É≥„Ç∏„É≥„ÅÆ‰∏ªË¶ÅÈÉ®ÂìÅ„ÄÇ‰∫§Êèõ„Åô„Çã„Å®Âá∫Ë∂≥Âêë‰∏ä", category: "equipment", importance: "low" },
      { term: "„Éö„É©Ë™øÊï¥", definition: "„Éó„É≠„Éö„É©„ÅÆËßíÂ∫¶„ÇÑÂΩ¢Áä∂„ÇíË™øÊï¥„Åô„Çã„Åì„Å®", category: "equipment", importance: "low" },
      { term: "ÂâçÊ§ú", definition: "ÁØÄÂâçÊó•„ÅÆÊ§úÊüª„ÄÇ„É¢„Éº„Çø„ÉºÊäΩÈÅ∏„ÇÇË°å„Çè„Çå„Çã", category: "equipment", importance: "low" },
      { term: "„Ç∞„É©„É≥„Éó„É™", definition: "Âπ¥Êú´„Å´Ë°å„Çè„Çå„ÇãÊúÄÈ´òÂ≥∞„ÅÆSG„É¨„Éº„Çπ", category: "race", importance: "low" },
      { term: "„ÇØ„É©„Ç∑„ÉÉ„ÇØ", definition: "Êò•„Å´Ë°å„Çè„Çå„ÇãSG„É¨„Éº„Çπ", category: "race", importance: "low" },
      { term: "Ëª¢Ë¶Ü", definition: "Ëâá„Åå„Å≤„Å£„Åè„ÇäËøî„Çã„Åì„Å®", category: "race", importance: "low" },
      { term: "ËêΩÊ∞¥", definition: "ÈÅ∏Êâã„ÅåËâá„Åã„ÇâËêΩ„Å°„Çã„Åì„Å®", category: "race", importance: "low" },
      { term: "Â§±Ê†º", definition: "„É´„Éº„É´ÈÅïÂèç„Å™„Å©„ÅßË≥áÊ†º„ÇíÂ§±„ÅÜ„Åì„Å®", category: "race", importance: "low" },
      { term: "ÂÆâÂÆöÊùø", definition: "Âº∑È¢®ÊôÇ„Å´Ëâá„Å´Âèñ„Çä‰ªò„Åë„ÇãÂÆâÂÆöÁî®„ÅÆÊùø", category: "weather", importance: "low" },
      { term: "„ÅÜ„Å≠„Çä", definition: "Âë®Êúü„ÅÆÈï∑„ÅÑÊ≥¢„ÄÇËâá„ÅÆÊìçÁ∏¶„ÅåÈõ£„Åó„Åè„Å™„Çã", category: "weather", importance: "low" },
      { term: "Ê∑°Ê∞¥", definition: "Â°©ÂàÜ„ÇíÂê´„Åæ„Å™„ÅÑÊ∞¥„ÄÇÂ§ö„Åè„ÅÆÁ´∂ËâáÂ†¥„Åß‰ΩøÁî®", category: "weather", importance: "low" },
      { term: "Êµ∑Ê∞¥", definition: "Â°©ÂàÜ„ÇíÂê´„ÇÄÊ∞¥„ÄÇÊµÆÂäõ„ÅåÂ§ß„Åç„ÅÑ", category: "weather", importance: "low" },
      { term: "Âá∫Ëµ∞Ë°®", definition: "„É¨„Éº„Çπ„ÅÆÂá∫Â†¥ÈÅ∏Êâã‰∏ÄË¶ß„ÄÇÊßò„ÄÖ„Å™„Éá„Éº„Çø„ÅåË®òËºâ", category: "other", importance: "low" },
      { term: "Âë®ÂõûÂ±ïÁ§∫", definition: "Êú¨Áï™Ââç„Å´Ë°å„ÅÜ„Ç≥„Éº„Çπ2Âë®„ÅÆË©¶Ëµ∞", category: "other", importance: "low" },
      { term: "Â±ïÁ§∫„Çø„Ç§„É†", definition: "Â±ïÁ§∫Ëà™Ëµ∞„Åß„ÅÆÁõ¥Á∑ö„Çø„Ç§„É†„ÄÇÊ©üÂäõ„ÅÆÁõÆÂÆâ", category: "other", importance: "low" },
      { term: "‰∫àÊÉ≥Á¥ô", definition: "„É¨„Éº„Çπ‰∫àÊÉ≥„ÅåÊé≤Ëºâ„Åï„Çå„ÅüÊñ∞ËÅû", category: "other", importance: "low" },
      { term: "Ë≤∑„ÅÑÁõÆ", definition: "ËàüÂà∏„ÅßË≥ºÂÖ•„Åô„ÇãÁµÑ„ÅøÂêà„Çè„Åõ", category: "other", importance: "low" },
    ];

    const categoryNames = {
      course: "„Ç≥„Éº„Çπ",
      start: "„Çπ„Çø„Éº„Éà",
      technique: "Ê±∫„Åæ„ÇäÊâã",
      player: "ÈÅ∏Êâã",
      betting: "ËàüÂà∏",
      equipment: "„É¢„Éº„Çø„Éº„ÉªËâá",
      race: "„É¨„Éº„Çπ",
      weather: "Â§©ÂÄô„ÉªÊ∞¥Èù¢",
      other: "„Åù„ÅÆ‰ªñ"
    };

    const importanceNames = {
      high: "ÂøÖÈ†à",
      medium: "ÈáçË¶Å",
      low: "ÂøúÁî®"
    };

    // Load checked words from localStorage
    let checkedWords = new Set(JSON.parse(localStorage.getItem('boatrace-checked') || '[]'));

    let currentIndex = 0;
    let filteredWords = [...words];
    let currentCategory = "all";
    let currentImportance = "all";
    let currentUnderstood = "all";

    const card = document.getElementById('card');
    const term = document.getElementById('term');
    const definition = document.getElementById('definition');
    const categoryTag = document.getElementById('categoryTag');
    const importanceTag = document.getElementById('importanceTag');
    const checkStatusFront = document.getElementById('checkStatusFront');
    const checkStatusBack = document.getElementById('checkStatusBack');
    const currentSpan = document.getElementById('current');
    const totalSpan = document.getElementById('total');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const checkBtn = document.getElementById('checkBtn');
    const wordGrid = document.getElementById('wordGrid');
    const stats = document.getElementById('stats');
    const progressBar = document.getElementById('progressBar');
    const progressBarText = document.getElementById('progressBarText');
    const resetBtn = document.getElementById('resetBtn');
    const toast = document.getElementById('toast');
    const loginBtn = document.getElementById('loginBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    function saveCheckedWords() {
      localStorage.setItem('boatrace-checked', JSON.stringify([...checkedWords]));
      // Sync to cloud if logged in
      if (currentUser) {
        syncToCloud();
      }
    }

    function filterWords() {
      filteredWords = words.filter(w => {
        const categoryMatch = currentCategory === "all" || w.category === currentCategory;
        const importanceMatch = currentImportance === "all" || w.importance === currentImportance;
        let understoodMatch = true;
        if (currentUnderstood === "checked") {
          understoodMatch = checkedWords.has(w.term);
        } else if (currentUnderstood === "unchecked") {
          understoodMatch = !checkedWords.has(w.term);
        }
        return categoryMatch && importanceMatch && understoodMatch;
      });
      currentIndex = 0;
      updateCard();
      renderWordList();
      updateStats();
      updateProgressBar();
    }

    function updateProgressBar() {
      const total = words.length;
      const checked = checkedWords.size;
      const percentage = Math.round((checked / total) * 100);
      progressBar.style.width = percentage + '%';
      progressBarText.textContent = `${checked} / ${total} (${percentage}%)`;
    }

    function updateStats() {
      const highCount = words.filter(w => w.importance === "high").length;
      const mediumCount = words.filter(w => w.importance === "medium").length;
      const lowCount = words.filter(w => w.importance === "low").length;
      const highChecked = words.filter(w => w.importance === "high" && checkedWords.has(w.term)).length;
      const mediumChecked = words.filter(w => w.importance === "medium" && checkedWords.has(w.term)).length;
      const lowChecked = words.filter(w => w.importance === "low" && checkedWords.has(w.term)).length;
      
      stats.innerHTML = `
        ÂÖ®${words.length}Ë™û | 
        üî¥ÂøÖÈ†à: ${highChecked}/${highCount} | 
        üü°ÈáçË¶Å: ${mediumChecked}/${mediumCount} | 
        üü¢ÂøúÁî®: ${lowChecked}/${lowCount}
      `;
    }

    function updateCheckStatus() {
      if (filteredWords.length === 0) return;
      
      const word = filteredWords[currentIndex];
      const isChecked = checkedWords.has(word.term);
      
      if (isChecked) {
        checkStatusFront.innerHTML = '<span>‚úì</span> ÁêÜËß£Ê∏à„Åø';
        checkStatusFront.classList.remove('unchecked');
        checkStatusBack.innerHTML = '<span>‚úì</span> ÁêÜËß£Ê∏à„Åø';
        checkStatusBack.classList.remove('unchecked');
        checkBtn.textContent = '‚úï ÂèñÊ∂à';
        checkBtn.classList.add('checked');
      } else {
        checkStatusFront.innerHTML = '<span>‚òê</span> Êú™ÁêÜËß£';
        checkStatusFront.classList.add('unchecked');
        checkStatusBack.innerHTML = '<span>‚òê</span> Êú™ÁêÜËß£';
        checkStatusBack.classList.add('unchecked');
        checkBtn.textContent = '‚úì ÁêÜËß£„Åó„Åü';
        checkBtn.classList.remove('checked');
      }
    }

    function updateCard() {
      if (filteredWords.length === 0) {
        term.textContent = "Áî®Ë™û„Åå„ÅÇ„Çä„Åæ„Åõ„Çì";
        definition.textContent = "„Éï„Ç£„É´„Çø„Éº„ÇíÂ§âÊõ¥„Åó„Å¶„Åè„Å†„Åï„ÅÑ";
        categoryTag.textContent = "";
        importanceTag.textContent = "";
        importanceTag.className = "importance-tag";
        currentSpan.textContent = 0;
        totalSpan.textContent = 0;
        checkStatusFront.innerHTML = '';
        checkStatusBack.innerHTML = '';
        return;
      }
      
      const word = filteredWords[currentIndex];
      term.textContent = word.term;
      definition.textContent = word.definition;
      categoryTag.textContent = categoryNames[word.category];
      importanceTag.textContent = importanceNames[word.importance];
      importanceTag.className = `importance-tag ${word.importance}`;
      currentSpan.textContent = currentIndex + 1;
      totalSpan.textContent = filteredWords.length;
      
      card.classList.remove('flipped');
      
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === filteredWords.length - 1;
      
      updateCheckStatus();
    }

    function renderWordList() {
      wordGrid.innerHTML = '';
      filteredWords.forEach((word, index) => {
        const item = document.createElement('div');
        const isChecked = checkedWords.has(word.term);
        item.className = `word-item ${word.importance}` + (isChecked ? ' checked' : '');
        item.innerHTML = `
          <span class="check-icon">${isChecked ? '‚úì' : '‚òê'}</span>
          <span class="word-text">${word.term}</span>
        `;
        item.addEventListener('click', () => {
          currentIndex = index;
          updateCard();
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });
        wordGrid.appendChild(item);
      });
    }

    function toggleCheck() {
      if (filteredWords.length === 0) return;
      
      const word = filteredWords[currentIndex];
      if (checkedWords.has(word.term)) {
        checkedWords.delete(word.term);
        showToast(`„Äå${word.term}„Äç„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„ÇíÂ§ñ„Åó„Åæ„Åó„Åü`);
      } else {
        checkedWords.add(word.term);
        showToast(`„Äå${word.term}„Äç„ÇíÁêÜËß£Ê∏à„Åø„Å´„Åó„Åæ„Åó„ÅüÔºÅ`);
      }
      saveCheckedWords();
      updateCheckStatus();
      renderWordList();
      updateStats();
      updateProgressBar();
    }

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Event Listeners
    card.addEventListener('click', () => {
      card.classList.toggle('flipped');
    });

    prevBtn.addEventListener('click', () => {
      if (currentIndex > 0) {
        currentIndex--;
        updateCard();
      }
    });

    nextBtn.addEventListener('click', () => {
      if (currentIndex < filteredWords.length - 1) {
        currentIndex++;
        updateCard();
      }
    });

    shuffleBtn.addEventListener('click', () => {
      shuffle(filteredWords);
      currentIndex = 0;
      updateCard();
      renderWordList();
    });

    checkBtn.addEventListener('click', toggleCheck);

    resetBtn.addEventListener('click', async () => {
      if (confirm('ÂÖ®„Å¶„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
        checkedWords.clear();
        saveCheckedWords();
        filterWords();
        showToast('„ÉÅ„Çß„ÉÉ„ÇØ„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åó„Åü');
      }
    });

    loginBtn.addEventListener('click', () => {
      if (!supabaseClient) {
        showConfigModal();
      } else {
        showAuthModal();
      }
    });

    logoutBtn.addEventListener('click', handleLogout);

    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.category;
        filterWords();
      });
    });

    document.querySelectorAll('.importance-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.importance-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentImportance = btn.dataset.importance;
        filterWords();
      });
    });

    document.querySelectorAll('.understood-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.understood-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentUnderstood = btn.dataset.understood;
        filterWords();
      });
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      // Ignore if modal is open
      if (document.querySelector('.modal-overlay.show')) return;
      
      if (e.key === 'ArrowLeft' && currentIndex > 0) {
        currentIndex--;
        updateCard();
      } else if (e.key === 'ArrowRight' && currentIndex < filteredWords.length - 1) {
        currentIndex++;
        updateCard();
      } else if (e.key === ' ') {
        e.preventDefault();
        card.classList.toggle('flipped');
      } else if (e.key === 'Enter') {
        e.preventDefault();
        toggleCheck();
      }
    });

    // Initialize
    initSupabase();
    checkAuthState();
    updateCard();
    renderWordList();
    updateStats();
    updateProgressBar();
  </script>
</body>
</html>
